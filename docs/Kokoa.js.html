<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Kokoa.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Kokoa.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* KokoaNLP
Copyright (C) 2018  Astro

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see &lt;http://www.gnu.org/licenses/>. */

const Hangul = require('hangul-js');

/**
 * Object representing KokoaNLP model.
 * @typedef {Object} KokoaModel
 * @property {Object} wordFrequencies
 * @property {Object} wordScores
 */

/**
 * Extract chunks from the given document.
 * @private
 * @param {string} document
 * @returns {Array.&lt;string>}
 */
const extractChunks = (document) => {
  const alphabetRegex = /^[A-z]+$/;
  const hangulRegex = /^[가-힣]+$/;
  const numberRegex = /^[0-9]+$/;
  const chunks = [];
  document.split('').forEach((char) => {
    const previousChunk = chunks[chunks.length - 1] || '';
    if ((alphabetRegex.test(previousChunk) &amp;&amp; alphabetRegex.test(char)) // if char is alphabet
      || (hangulRegex.test(previousChunk) &amp;&amp; hangulRegex.test(char)) // if char is hangul
      || (numberRegex.test(previousChunk) &amp;&amp; numberRegex.test(char)) // if char is number
      || (previousChunk[previousChunk.length - 1] === char)) { // if char is repeated
      chunks[chunks.length - 1] += char;
    } else {
      chunks.push(char);
    }
  });
  return chunks;
};

/**
 * Extract subtexts from the given chunk.
 * @private
 * @param {string} chunk
 * @returns {Array.&lt;string>}
 */
const extractSubtexts = (chunk) => {
  const subtexts = [];
  const chars = Hangul.disassemble(chunk);
  for (let i = 1, len = chars.length; i &lt;= len; i += 1) {
    const subtext = Hangul.assemble(chars.slice(0, i));
    if (!Hangul.isConsonant(subtext[subtext.length - 1])) {
      subtexts.push(subtext);
    }
  }
  return subtexts;
};

/**
 * Class representing KokoaNLP.
 */
class Kokoa {
  /**
   * Create KokoaNLP instance.
   */
  constructor() {
    this.wordFrequencies = {};
    this.wordScores = {};
  }

  /**
   * Load KokoaNLP instance from the given model.
   * @param {KokoaModel} model
   */
  static load({ wordFrequencies, wordScores }) {
    const kokoa = new Kokoa();
    kokoa.wordFrequencies = wordFrequencies;
    kokoa.wordScores = wordScores;
    return kokoa;
  }

  /**
   * Analyze the given document.
   * @param {string} document
   * @param {Object} [options]
   * @param {boolean} [options.hangulOnly=true]
   * @param {number} [options.threshold=3]
   * @returns {Array.&lt;string>}
   */
  run(document, { hangulOnly = true, threshold = 3 } = {}) {
    const { wordFrequencies, wordScores } = this;
    const chunks = extractChunks(document);
    const words = [];
    chunks.forEach((chunk) => {
      if (Hangul.isHangulAll(chunk)) {
        const subtexts = extractSubtexts(chunk);
        const word = subtexts.map(value => [value, value in wordScores ? wordScores[value] : 0])
          .reduce((r, a) => (a[1] > r[1] ? a : r))[0];
        if (wordFrequencies[word] >= threshold) {
          words.push(word);
        }
      } else if (!hangulOnly) {
        words.push(chunk);
      }
    });
    return words;
  }

  /**
   * Save KokoaNLP model as a model.
   * @returns {KokoaModel}
   */
  save() {
    const { wordFrequencies, wordScores } = this;
    return { wordFrequencies, wordScores };
  }

  /**
   * Train the given document.
   * @param {string} document
   */
  train(document) {
    const { wordFrequencies, wordScores } = this;
    const chunks = extractChunks(document).filter(Hangul.isHangul).map(extractSubtexts);
    // Extract all words and count how many words appear.
    for (let i = 0, len = chunks.length; i &lt; len; i += 1) {
      const subtexts = chunks[i];
      for (let j = 0, len2 = subtexts.length; j &lt; len2; j += 1) {
        const subtext = subtexts[j];
        if (subtext in wordFrequencies) {
          wordFrequencies[subtext] += 1;
        } else {
          wordFrequencies[subtext] = 1;
        }
      }
    }
    // Calculate cohension n-gram value.
    const uniqueSubtexts = Object.keys(wordFrequencies);
    for (let i = 0, len = uniqueSubtexts.length; i &lt; len; i += 1) {
      const subtext = uniqueSubtexts[i];
      if (subtext.length === 1) {
        wordScores[subtext] = 0.1;
      } else {
        const exp = 1 / Hangul.disassemble(subtext).length;
        wordScores[subtext] = (wordFrequencies[subtext] / wordFrequencies[subtext[0]]) ** exp;
      }
    }
  }

}

module.exports = Kokoa;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Kokoa.html">Kokoa</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed May 16 2018 22:46:04 GMT+0900 (KST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
